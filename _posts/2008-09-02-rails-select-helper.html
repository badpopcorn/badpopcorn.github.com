--- 
layout: post
author: moe
title: Rails Select Helper
published: true
meta: 
  _edit_last: "9"
tags: 
- Rails
- REST
- Ruby
- Technology
- Web
type: post
status: publish
---
<p>One of the major benefits of <a href="http://rubyonrails.org">Ruby on Rails</a> is <a href="http://en.wikipedia.org/wiki/Rapid_application_development">rapid development</a>. Something that we love at BadPopcorn. Rails has great helper methods to minimize code and bugs. One of my favorites is the select helper. There are several different ways to make a <a href="http://shiningthrough.co.uk/blog/show/6">select tag</a>, but I am going to demonstrate the one I like best. Let's say you are creating a new "gym member". He will have a name and belong to a gym.</p>

<p><strong>View</strong></p>

{% highlight erb linenos %}
<%= form_for(@member) do |f| %>
  <%= f.text_field :name %>
  <%= select :member,:gym_id,Gym.find(:all).collect{|p| [p.name, p.id]}%>
  <%= f.submit "Create" %>
<% end %>
{% endhighlight %}

Line 1 builds the <a href="http://api.rubyonrails.org/v2.3.8/classes/ActionView/Helpers/FormHelper.html">form</a>. Rails uses the <code>@member</code> variable to generate the action, id, and name of the form.

{% highlight html %}
<form id="new_member" class="new_member" action="/members" method="post">
{% endhighlight %}

Notice the <code>do | f |</code> code in the form deceleration (line 1). You can now use the local variable <code>f</code> to bind attributes of member to input variables. Line 2 of the code generates the below html. The name of the input variable is a Rails convention.

{% highlight html %}
<input id="member_name" name="member[name]" size="30" type="text" />
{% endhighlight %}

Line 3 is the Rails select tag helper. The select tag generates the html select tag cleanly. The <code>name</code> of the select is dynamically created by using the first two parameters of the helper function <code>:member</code> and <code>:name</code>. The options are generated by the third parameter.

{% highlight html %}
<select id="member_gym_id" name="member[gym_id]">
   <option value="1">Get Ripped Here</option>
   <option value="2">Hot Girls Welcome</option>
</select>
{% endhighlight %}

Line 4 creates the html submit button.

{% highlight html %}
<input id="member_submit" name="commit" type="submit" value="Create" />
{% endhighlight %}

<p>Also, Rails will throw an exception if you attempt to bind to a member attribute that does not exist.</p>

For example,
{% highlight erb %}
<%= f.text_field :height %>
{% endhighlight %}

<p>will throw the exception: <code>undefined method `height' for #</code>.  Changing the "gym_id" parameter in the select helper will cause the same type of exception. This will save you from making dumb mistakes time and time again.</p>

<p><em>So what's posted?</em></p>

<p>This is where the rails form helper tags come in useful. An organized list of Member was passed as a post parameter to the controller.</p>

{% highlight bash %}
Parameters: {"commit"=>"Create", "member"=>{"name"=>"moe", "gym_id"=>"1"},
"authenticity_token"=>"52646c5a18d11c6009b5597af3bf798942a59c0a",
"action"=>"create", "controller"=>"members"}
{% endhighlight %}

<p><strong>Controller</strong></p>

<p>When the form is posted it will hit the "create" function in the members controller by default. You can <a href="http://api.rubyonrails.org/v2.3.8/classes/ActionView/Helpers/FormHelper.html">change</a> where it will post to if necessary.</p>

{% highlight ruby linenos %}
def create
  @member = Member.new(params[:member])
  respond_to do |format|
    if @member.save
      flash[:notice] = 'Member was successfully created.'
      format.html { redirect_to(@member) }
    end
  end
end
{% endhighlight %}

<p>Line 2 makes a new instance of Member and passes the post parameter member list in the constructor. This returns a member object with the name and gym_id set properly. Line 4 saves the new member in the database.</p>

{% highlight bash %}
Member Create (0.000386)   INSERT INTO members ("name", "updated_at",
"gym_id", "created_at") VALUES('moe', '2008-09-02 02:00:35', 1,
'2008-09-02 02:00:35')
{% endhighlight %}

<p>The same type exception(s), discussed earlier, will occur here. For example, an exception will be thrown if there is a "height" attribute in the members post parameter.</p>

<p><strong>How we saved time (the short list)</strong></p>

<ol>
	<li> Initially we didn't have to pass much to the view. Just an instance of Member.</li>
	<li>We were able to use the Rails html helper to build the correct form quickly.</li>
	<li>Rails conventions made it easy to know where the post would be directed to within the controller.</li>
	<li>In two lines we created a new Member instance, updated the values with the posted parameters and updated the database.</li>
	<li>It's also worth noting that the Rails error checking, when using the helper tags, saves us a lot of debugging time.</li>
</ol>

<p><strong>What's Next?</strong></p>

<p>Input validation. Making sure the user isn't inputting dumb data. For example, in the above code the user could use undesirable characters in their name. Yup, that's super simple too.</p>
